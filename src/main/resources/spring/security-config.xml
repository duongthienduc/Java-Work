<beans:beans xmlns="http://www.springframework.org/schema/security"
  xmlns:beans="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/security
           http://www.springframework.org/schema/security/spring-security.xsd">
          
	<http pattern="/assets/**" security="none"/>
	<http pattern="/login.jv" security="none"/>
	<http pattern="/forgotPassword.jv" security="none"/>
	<http pattern="/doSendForgotPasswordMail.jv" security="none"  />
	<http pattern="/resetPassword.jv" security="none"/>
	<http pattern="/doResetPassword.jv" security="none"/>
	<http pattern="/changePassword.jv" security="none"/>
	<http pattern="/sessionExpired.jv" security="none"/>
	<http pattern="/dwr/**" security="none"/>
	
	<http auto-config="false" 
			entry-point-ref="loginEntryPoint"
			access-decision-manager-ref="jvAccessDecisionManager">
		<intercept-url pattern="/**" access="ROLE_USER" requires-channel="any"/>
		<access-denied-handler ref="jvAccessDeniedHandler"/>
		<custom-filter position="LOGOUT_FILTER" ref="jvLogoutFilter" />
		<custom-filter position="FORM_LOGIN_FILTER" ref="jvAuthenticationFilter" />
		<custom-filter position="CONCURRENT_SESSION_FILTER" ref="concurrencyFilter" />
		<custom-filter position="LAST" ref="changePasswordFilter"/>
		<session-management session-authentication-strategy-ref="concurrentSessionControlStrategy" />
	</http>
	
	<beans:bean id="loginEntryPoint"
		class="vn.jv.web.security.JvEntryPoint">
		<beans:property name="loginFormUrl" value="/login.jv" />
		<beans:property name="forceHttps" value="false" />
	</beans:bean>
    <beans:bean id="jvAccessDecisionManager" class="vn.jv.web.security.JvAccessDecisionManager"/>
    <beans:bean id="jvAccessDeniedHandler" class="vn.jv.web.security.JvAccessDeniedHandler">
		<beans:property name="errorPage" value="/accessDenied.jv" />
    </beans:bean>
	<authentication-manager alias="authenticationManager">
		<authentication-provider user-service-ref="jvUserDetailsService">
			<password-encoder ref="passwordEncoder">
				<salt-source user-property="username" />
			</password-encoder>
		</authentication-provider>
	</authentication-manager>
    <beans:bean id="passwordEncoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder">
    	<beans:constructor-arg type="int" value="512" />
    </beans:bean>
	
	<beans:bean id="jvAuthenticationFilter" class="vn.jv.web.security.JvAuthenticationFilter">
		<beans:property name="filterProcessesUrl" value="/login" />
		<beans:property name="usernameParameter" value="userEmail" />
		<beans:property name="passwordParameter" value="password" />
		<beans:property name="authenticationManager" ref="authenticationManager" />
		<beans:property name="authenticationSuccessHandler" ref="jvSuccessLoginHandler" />
		<beans:property name="authenticationFailureHandler" ref="jvFailureLoginHandler" />
		<beans:property name="sessionAuthenticationStrategy" ref="concurrentSessionControlStrategy" />
	</beans:bean>
	<beans:bean id="jvSuccessLoginHandler" class="vn.jv.web.security.JvSuccessLoginHandler" />
	<beans:bean id="jvFailureLoginHandler" class="vn.jv.web.security.JvFailureLoginHandler" >
		<beans:property name="defaultFailureUrl" value="/login.jv" />
	</beans:bean>
	<beans:bean id="concurrentSessionControlStrategy"
		class="org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy">
		<beans:constructor-arg name="sessionRegistry"
			ref="sessionRegistry" />
		<beans:property name="maximumSessions" value="1" />
	</beans:bean>
	
	<beans:bean id="jvLogoutFilter" class="vn.jv.web.security.JvLogoutFilter" >
		<beans:constructor-arg index="0" ref="jvLogoutSuccessHandler" />
		<beans:constructor-arg index="1" ref="logoutHandler" />
		<beans:property name="filterProcessesUrl" value="/logout" />
	</beans:bean>
	<beans:bean id="jvLogoutSuccessHandler" class="vn.jv.web.security.JvLogoutSuccessHandler" />
	<beans:bean id="logoutHandler" class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler" />
	
	<beans:bean id="jvSessionExpiredRedirectStrategy" class="vn.jv.web.security.JvSessionExpiredRedirectStrategy" />
	<beans:bean id="concurrencyFilter"
		class="org.springframework.security.web.session.ConcurrentSessionFilter">
		<beans:property name="sessionRegistry" ref="sessionRegistry" />
		<beans:property name="expiredUrl" value="/sessionExpired.jv" />
		<beans:property name="redirectStrategy" ref="jvSessionExpiredRedirectStrategy" />
	</beans:bean>
	
	<beans:bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl" />
	
	<beans:bean id="changePasswordFilter"  class="vn.jv.web.security.ChangePasswordFilter" />
</beans:beans>
